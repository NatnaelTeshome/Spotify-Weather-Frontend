{"ast":null,"code":"let id = '4aa2e2d16efe46e198d444f232e96695'; // client id\n\nlet sec = '42147b97f5254fc1b06949d1cc3f0694'; // secret\n\nconst redirect_uri = 'http://localhost:3000'; // feel free to edit\n\nlet access_token = null;\nlet refresh_token = null;\nlet currentPlaylist = \"\";\nlet radioButtons = [];\nconst AUTHORIZE = \"https://accounts.spotify.com/authorize\";\nconst TOKEN = \"https://accounts.spotify.com/api/token\";\nconst PLAYLISTS = \"https://api.spotify.com/v1/me/playlists\";\nconst DEVICES = \"https://api.spotify.com/v1/me/player/devices\";\nconst PLAY = \"https://api.spotify.com/v1/me/player/play\";\nconst PAUSE = \"https://api.spotify.com/v1/me/player/pause\";\nconst NEXT = \"https://api.spotify.com/v1/me/player/next\";\nconst PREVIOUS = \"https://api.spotify.com/v1/me/player/previous\";\nconst PLAYER = \"https://api.spotify.com/v1/me/player\";\nconst TRACKS = \"https://api.spotify.com/v1/playlists/{{PlaylistId}}/tracks\";\nconst CURRENTLYPLAYING = \"https://api.spotify.com/v1/me/player/currently-playing\";\nconst SHUFFLE = \"https://api.spotify.com/v1/me/player/shuffle\";\nexport const onPageLoad = () => {\n  id = localStorage.getItem(\"id\");\n  sec = localStorage.getItem(\"sec\");\n\n  if (window.location.search.length > 0) {\n    handleRedirect();\n  } else {\n    access_token = localStorage.getItem(\"access_token\");\n\n    if (access_token === null) {// we don't have an access token so present token section\n    } else {// we have an access token so present device section\n    }\n  }\n};\nexport const handleRedirect = () => {\n  let code = getCode();\n  fetchAccessToken(code);\n  window.history.pushState(\"\", \"\", redirect_uri); // remove param from url\n};\nexport const getCode = () => {\n  let code = null;\n  const queryString = window.location.search;\n\n  if (queryString.length > 0) {\n    const urlParams = new URLSearchParams(queryString);\n    code = urlParams.get('code');\n  }\n\n  return code;\n};\nexport const requestAuthorization = () => {\n  // TODO: get id's from backend\n  let url = AUTHORIZE;\n  url += \"?client_id=\" + id;\n  url += \"&response_type=code\";\n  url += \"&redirect_uri=\" + encodeURI(redirect_uri);\n  url += \"&show_dialog=true\";\n  url += \"&scope=user-read-private user-read-email user-modify-playback-state user-read-playback-position user-library-read streaming user-read-playback-state user-read-recently-played playlist-read-private\";\n  window.location.href = url; // Show Spotify's authorization screen\n};\nexport const fetchAccessToken = code => {\n  let body = \"grant_type=authorization_code\";\n  body += \"&code=\" + code;\n  body += \"&redirect_uri=\" + encodeURI(redirect_uri);\n  body += \"&id=\" + id;\n  body += \"&sec=\" + sec;\n  callAuthorizationApi(body);\n};\nexport const refreshAccessToken = () => {\n  refresh_token = localStorage.getItem(\"refresh_token\");\n  let body = \"grant_type=refresh_token\";\n  body += \"&refresh_token=\" + refresh_token;\n  body += \"&id=\" + id;\n  callAuthorizationApi(body);\n};\nexport const callAuthorizationApi = body => {\n  let xhr = new XMLHttpRequest();\n  xhr.open(\"POST\", TOKEN, true);\n  xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');\n  xhr.setRequestHeader('Authorization', 'Basic ' + btoa(id + \":\" + sec));\n  xhr.send(body);\n  xhr.onload = handleAuthorizationResponse;\n};\nexport const handleAuthorizationResponse = () => {\n  if (this.status === 200) {\n    const data = JSON.parse(this.responseText);\n    console.log(data);\n\n    if (data.access_token !== undefined) {\n      access_token = data.access_token;\n      localStorage.setItem(\"access_token\", access_token);\n    }\n\n    if (data.refresh_token !== undefined) {\n      refresh_token = data.refresh_token;\n      localStorage.setItem(\"refresh_token\", refresh_token);\n    }\n\n    onPageLoad();\n  } else {\n    console.log(this.responseText);\n    alert(this.responseText);\n  }\n};\nexport const refreshDevices = () => {\n  callApi(\"GET\", DEVICES, null, handleDevicesResponse);\n};\nexport const handleDevicesResponse = () => {\n  if (this.status === 200) {\n    const data = JSON.parse(this.responseText);\n    console.log(data);\n    removeAllItems(\"devices\");\n    data.devices.forEach(item => addDevice(item));\n  } else if (this.status === 401) {\n    refreshAccessToken();\n  } else {\n    console.log(this.responseText);\n    alert(this.responseText);\n  }\n};\nexport const addDevice = item => {\n  let node = document.createElement(\"option\");\n  node.value = item.id;\n  node.innerHTML = item.name;\n  document.getElementById(\"devices\").appendChild(node);\n};\nexport const callApi = (method, url, body, callback) => {\n  let xhr = new XMLHttpRequest();\n  xhr.open(method, url, true);\n  xhr.setRequestHeader('Content-Type', 'application/json');\n  xhr.setRequestHeader('Authorization', 'Bearer ' + access_token);\n  xhr.send(body);\n  xhr.onload = callback;\n};\nexport const refreshPlaylists = () => {\n  callApi(\"GET\", PLAYLISTS, null, handlePlaylistsResponse);\n};\nexport const handlePlaylistsResponse = () => {\n  if (this.status === 200) {\n    const data = JSON.parse(this.responseText);\n    console.log(data);\n    removeAllItems(\"playlists\");\n    data.items.forEach(item => addPlaylist(item));\n    document.getElementById('playlists').value = currentPlaylist;\n  } else if (this.status === 401) {\n    refreshAccessToken();\n  } else {\n    console.log(this.responseText);\n    alert(this.responseText);\n  }\n};\nexport const addPlaylist = item => {\n  let node = document.createElement(\"option\");\n  node.value = item.id;\n  node.innerHTML = item.name + \" (\" + item.tracks.total + \")\";\n  document.getElementById(\"playlists\").appendChild(node);\n};\nexport const removeAllItems = elementId => {\n  let node = document.getElementById(elementId);\n\n  while (node.firstChild) {\n    node.removeChild(node.firstChild);\n  }\n};\nexport const play = () => {\n  let playlist_id = document.getElementById(\"playlists\").value;\n  let trackindex = document.getElementById(\"tracks\").value;\n  let album = document.getElementById(\"album\").value;\n  let body = {};\n\n  if (album.length > 0) {\n    body.context_uri = album;\n  } else {\n    body.context_uri = \"spotify:playlist:\" + playlist_id;\n  }\n\n  body.offset = {};\n  body.offset.position = trackindex.length > 0 ? Number(trackindex) : 0;\n  body.offset.position_ms = 0;\n  callApi(\"PUT\", PLAY + \"?device_id=\" + deviceId(), JSON.stringify(body), handleApiResponse);\n};\nexport const shuffle = () => {\n  callApi(\"PUT\", SHUFFLE + \"?state=true&device_id=\" + deviceId(), null, handleApiResponse);\n  play();\n};\nexport const pause = () => {\n  callApi(\"PUT\", PAUSE + \"?device_id=\" + deviceId(), null, handleApiResponse);\n};\nexport const next = () => {\n  callApi(\"POST\", NEXT + \"?device_id=\" + deviceId(), null, handleApiResponse);\n};\nexport const previous = () => {\n  callApi(\"POST\", PREVIOUS + \"?device_id=\" + deviceId(), null, handleApiResponse);\n};\nexport const transfer = () => {\n  let body = {};\n  body.device_ids = [];\n  body.device_ids.push(deviceId());\n  callApi(\"PUT\", PLAYER, JSON.stringify(body), handleApiResponse);\n};\nexport const handleApiResponse = () => {\n  if (this.status === 200) {\n    console.log(this.responseText);\n    setTimeout(currentlyPlaying, 2000);\n  } else if (this.status === 204) {\n    setTimeout(currentlyPlaying, 2000);\n  } else if (this.status === 401) {\n    refreshAccessToken();\n  } else {\n    console.log(this.responseText);\n    alert(this.responseText);\n  }\n};\nexport const deviceId = () => {\n  return document.getElementById(\"devices\").value;\n};\nexport const fetchTracks = () => {\n  let playlist_id = document.getElementById(\"playlists\").value;\n\n  if (playlist_id.length > 0) {\n    const url = TRACKS.replace(\"{{PlaylistId}}\", playlist_id);\n    callApi(\"GET\", url, null, handleTracksResponse);\n  }\n};\nexport const handleTracksResponse = () => {\n  if (this.status === 200) {\n    const data = JSON.parse(this.responseText);\n    console.log(data);\n    removeAllItems(\"tracks\");\n    data.items.forEach((item, index) => addTrack(item, index));\n  } else if (this.status === 401) {\n    refreshAccessToken();\n  } else {\n    console.log(this.responseText);\n    alert(this.responseText);\n  }\n};\nexport const addTrack = (item, index) => {\n  let node = document.createElement(\"option\");\n  node.value = index;\n  node.innerHTML = item.track.name + \" (\" + item.track.artists[0].name + \")\";\n  document.getElementById(\"tracks\").appendChild(node);\n};\nexport const currentlyPlaying = () => {\n  callApi(\"GET\", PLAYER + \"?market=US\", null, handleCurrentlyPlayingResponse);\n};\nexport const handleCurrentlyPlayingResponse = () => {\n  if (this.status === 200) {\n    const data = JSON.parse(this.responseText);\n    console.log(data);\n\n    if (data.item !== null) {\n      document.getElementById(\"albumImage\").src = data.item.album.images[0].url;\n      document.getElementById(\"trackTitle\").innerHTML = data.item.name;\n      document.getElementById(\"trackArtist\").innerHTML = data.item.artists[0].name;\n    }\n\n    if (data.device !== null) {\n      // select device\n      const currentDevice = data.device.id;\n      document.getElementById('devices').value = currentDevice;\n    }\n\n    if (data.context !== null) {\n      // select playlist\n      currentPlaylist = data.context.uri;\n      currentPlaylist = currentPlaylist.substring(currentPlaylist.lastIndexOf(\":\") + 1, currentPlaylist.length);\n      document.getElementById('playlists').value = currentPlaylist;\n    }\n  } else if (this.status === 204) {} else if (this.status === 401) {\n    refreshAccessToken();\n  } else {\n    console.log(this.responseText);\n    alert(this.responseText);\n  }\n};","map":{"version":3,"sources":["/Users/johnboesen/Documents/Code/Spotify-Weather-Frontend/src/api-functions.js"],"names":["id","sec","redirect_uri","access_token","refresh_token","currentPlaylist","radioButtons","AUTHORIZE","TOKEN","PLAYLISTS","DEVICES","PLAY","PAUSE","NEXT","PREVIOUS","PLAYER","TRACKS","CURRENTLYPLAYING","SHUFFLE","onPageLoad","localStorage","getItem","window","location","search","length","handleRedirect","code","getCode","fetchAccessToken","history","pushState","queryString","urlParams","URLSearchParams","get","requestAuthorization","url","encodeURI","href","body","callAuthorizationApi","refreshAccessToken","xhr","XMLHttpRequest","open","setRequestHeader","btoa","send","onload","handleAuthorizationResponse","status","data","JSON","parse","responseText","console","log","undefined","setItem","alert","refreshDevices","callApi","handleDevicesResponse","removeAllItems","devices","forEach","item","addDevice","node","document","createElement","value","innerHTML","name","getElementById","appendChild","method","callback","refreshPlaylists","handlePlaylistsResponse","items","addPlaylist","tracks","total","elementId","firstChild","removeChild","play","playlist_id","trackindex","album","context_uri","offset","position","Number","position_ms","deviceId","stringify","handleApiResponse","shuffle","pause","next","previous","transfer","device_ids","push","setTimeout","currentlyPlaying","fetchTracks","replace","handleTracksResponse","index","addTrack","track","artists","handleCurrentlyPlayingResponse","src","images","device","currentDevice","context","uri","substring","lastIndexOf"],"mappings":"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","sourcesContent":["let id = '4aa2e2d16efe46e198d444f232e96695'; // client id\nlet sec = '42147b97f5254fc1b06949d1cc3f0694'; // secret\nconst redirect_uri = 'http://localhost:3000'; // feel free to edit\n\nlet access_token = null;\nlet refresh_token = null;\nlet currentPlaylist = \"\";\nlet radioButtons = [];\n\nconst AUTHORIZE = \"https://accounts.spotify.com/authorize\"\nconst TOKEN = \"https://accounts.spotify.com/api/token\";\nconst PLAYLISTS = \"https://api.spotify.com/v1/me/playlists\";\nconst DEVICES = \"https://api.spotify.com/v1/me/player/devices\";\nconst PLAY = \"https://api.spotify.com/v1/me/player/play\";\nconst PAUSE = \"https://api.spotify.com/v1/me/player/pause\";\nconst NEXT = \"https://api.spotify.com/v1/me/player/next\";\nconst PREVIOUS = \"https://api.spotify.com/v1/me/player/previous\";\nconst PLAYER = \"https://api.spotify.com/v1/me/player\";\nconst TRACKS = \"https://api.spotify.com/v1/playlists/{{PlaylistId}}/tracks\";\nconst CURRENTLYPLAYING = \"https://api.spotify.com/v1/me/player/currently-playing\";\nconst SHUFFLE = \"https://api.spotify.com/v1/me/player/shuffle\";\n\nexport const onPageLoad = () => {\n    id = localStorage.getItem(\"id\");\n    sec = localStorage.getItem(\"sec\");\n    if (window.location.search.length > 0) {\n        handleRedirect();\n    }\n    else {\n        access_token = localStorage.getItem(\"access_token\");\n        if (access_token === null) {\n            // we don't have an access token so present token section\n\n        }\n        else {\n            // we have an access token so present device section\n        }\n    }\n}\n\nexport const handleRedirect = () => {\n    let code = getCode();\n    fetchAccessToken(code);\n    window.history.pushState(\"\", \"\", redirect_uri); // remove param from url\n}\n\nexport const getCode = () => {\n    let code = null;\n    const queryString = window.location.search;\n    if (queryString.length > 0) {\n        const urlParams = new URLSearchParams(queryString);\n        code = urlParams.get('code')\n    }\n    return code;\n}\n\nexport const requestAuthorization = () => {\n    // TODO: get id's from backend\n    let url = AUTHORIZE;\n    url += \"?client_id=\" + id;\n    url += \"&response_type=code\";\n    url += \"&redirect_uri=\" + encodeURI(redirect_uri);\n    url += \"&show_dialog=true\";\n    url += \"&scope=user-read-private user-read-email user-modify-playback-state user-read-playback-position user-library-read streaming user-read-playback-state user-read-recently-played playlist-read-private\";\n    window.location.href = url; // Show Spotify's authorization screen\n}\n\nexport const fetchAccessToken = (code) => {\n    let body = \"grant_type=authorization_code\";\n    body += \"&code=\" + code;\n    body += \"&redirect_uri=\" + encodeURI(redirect_uri);\n    body += \"&id=\" + id;\n    body += \"&sec=\" + sec;\n    callAuthorizationApi(body);\n}\n\nexport const refreshAccessToken = () => {\n    refresh_token = localStorage.getItem(\"refresh_token\");\n    let body = \"grant_type=refresh_token\";\n    body += \"&refresh_token=\" + refresh_token;\n    body += \"&id=\" + id;\n    callAuthorizationApi(body);\n}\n\nexport const callAuthorizationApi = (body) => {\n    let xhr = new XMLHttpRequest();\n    xhr.open(\"POST\", TOKEN, true);\n    xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');\n    xhr.setRequestHeader('Authorization', 'Basic ' + btoa(id + \":\" + sec));\n    xhr.send(body);\n    xhr.onload = handleAuthorizationResponse;\n}\n\nexport const handleAuthorizationResponse = () => {\n    if (this.status === 200) {\n        const data = JSON.parse(this.responseText);\n        console.log(data);\n        if (data.access_token !== undefined) {\n            access_token = data.access_token;\n            localStorage.setItem(\"access_token\", access_token);\n        }\n        if (data.refresh_token !== undefined) {\n            refresh_token = data.refresh_token;\n            localStorage.setItem(\"refresh_token\", refresh_token);\n        }\n        onPageLoad();\n    }\n    else {\n        console.log(this.responseText);\n        alert(this.responseText);\n    }\n}\n\nexport const refreshDevices = () => {\n    callApi(\"GET\", DEVICES, null, handleDevicesResponse);\n}\n\nexport const handleDevicesResponse = () => {\n    if (this.status === 200) {\n        const data = JSON.parse(this.responseText);\n        console.log(data);\n        removeAllItems(\"devices\");\n        data.devices.forEach(item => addDevice(item));\n    }\n    else if (this.status === 401) {\n        refreshAccessToken()\n    }\n    else {\n        console.log(this.responseText);\n        alert(this.responseText);\n    }\n}\n\nexport const addDevice = (item) => {\n    let node = document.createElement(\"option\");\n    node.value = item.id;\n    node.innerHTML = item.name;\n    document.getElementById(\"devices\").appendChild(node);\n}\n\nexport const callApi = (method, url, body, callback) => {\n    let xhr = new XMLHttpRequest();\n    xhr.open(method, url, true);\n    xhr.setRequestHeader('Content-Type', 'application/json');\n    xhr.setRequestHeader('Authorization', 'Bearer ' + access_token);\n    xhr.send(body);\n    xhr.onload = callback;\n}\n\nexport const refreshPlaylists = () => {\n    callApi(\"GET\", PLAYLISTS, null, handlePlaylistsResponse);\n}\n\nexport const handlePlaylistsResponse = () => {\n    if (this.status === 200) {\n        const data = JSON.parse(this.responseText);\n        console.log(data);\n        removeAllItems(\"playlists\");\n        data.items.forEach(item => addPlaylist(item));\n        document.getElementById('playlists').value = currentPlaylist;\n    }\n    else if (this.status === 401) {\n        refreshAccessToken()\n    }\n    else {\n        console.log(this.responseText);\n        alert(this.responseText);\n    }\n}\n\nexport const addPlaylist = (item) => {\n    let node = document.createElement(\"option\");\n    node.value = item.id;\n    node.innerHTML = item.name + \" (\" + item.tracks.total + \")\";\n    document.getElementById(\"playlists\").appendChild(node);\n}\n\nexport const removeAllItems = (elementId) => {\n    let node = document.getElementById(elementId);\n    while (node.firstChild) {\n        node.removeChild(node.firstChild);\n    }\n}\n\nexport const play = () => {\n    let playlist_id = document.getElementById(\"playlists\").value;\n    let trackindex = document.getElementById(\"tracks\").value;\n    let album = document.getElementById(\"album\").value;\n    let body = {};\n    if (album.length > 0) {\n        body.context_uri = album;\n    }\n    else {\n        body.context_uri = \"spotify:playlist:\" + playlist_id;\n    }\n    body.offset = {};\n    body.offset.position = trackindex.length > 0 ? Number(trackindex) : 0;\n    body.offset.position_ms = 0;\n    callApi(\"PUT\", PLAY + \"?device_id=\" + deviceId(), JSON.stringify(body), handleApiResponse);\n}\n\nexport const shuffle = () => {\n    callApi(\"PUT\", SHUFFLE + \"?state=true&device_id=\" + deviceId(), null, handleApiResponse);\n    play();\n}\n\nexport const pause = () => {\n    callApi(\"PUT\", PAUSE + \"?device_id=\" + deviceId(), null, handleApiResponse);\n}\n\nexport const next = () => {\n    callApi(\"POST\", NEXT + \"?device_id=\" + deviceId(), null, handleApiResponse);\n}\n\nexport const previous = () => {\n    callApi(\"POST\", PREVIOUS + \"?device_id=\" + deviceId(), null, handleApiResponse);\n}\n\nexport const transfer = () => {\n    let body = {};\n    body.device_ids = [];\n    body.device_ids.push(deviceId())\n    callApi(\"PUT\", PLAYER, JSON.stringify(body), handleApiResponse);\n}\n\nexport const handleApiResponse = () => {\n    if (this.status === 200) {\n        console.log(this.responseText);\n        setTimeout(currentlyPlaying, 2000);\n    }\n    else if (this.status === 204) {\n        setTimeout(currentlyPlaying, 2000);\n    }\n    else if (this.status === 401) {\n        refreshAccessToken()\n    }\n    else {\n        console.log(this.responseText);\n        alert(this.responseText);\n    }\n}\n\nexport const deviceId = () => {\n    return document.getElementById(\"devices\").value;\n}\n\nexport const fetchTracks = () => {\n    let playlist_id = document.getElementById(\"playlists\").value;\n    if (playlist_id.length > 0) {\n        const url = TRACKS.replace(\"{{PlaylistId}}\", playlist_id);\n        callApi(\"GET\", url, null, handleTracksResponse);\n    }\n}\n\nexport const handleTracksResponse = () => {\n    if (this.status === 200) {\n        const data = JSON.parse(this.responseText);\n        console.log(data);\n        removeAllItems(\"tracks\");\n        data.items.forEach((item, index) => addTrack(item, index));\n    }\n    else if (this.status === 401) {\n        refreshAccessToken()\n    }\n    else {\n        console.log(this.responseText);\n        alert(this.responseText);\n    }\n}\n\nexport const addTrack = (item, index) => {\n    let node = document.createElement(\"option\");\n    node.value = index;\n    node.innerHTML = item.track.name + \" (\" + item.track.artists[0].name + \")\";\n    document.getElementById(\"tracks\").appendChild(node);\n}\n\nexport const currentlyPlaying = () => {\n    callApi(\"GET\", PLAYER + \"?market=US\", null, handleCurrentlyPlayingResponse);\n}\n\nexport const handleCurrentlyPlayingResponse = () => {\n    if (this.status === 200) {\n        const data = JSON.parse(this.responseText);\n        console.log(data);\n        if (data.item !== null) {\n            document.getElementById(\"albumImage\").src = data.item.album.images[0].url;\n            document.getElementById(\"trackTitle\").innerHTML = data.item.name;\n            document.getElementById(\"trackArtist\").innerHTML = data.item.artists[0].name;\n        }\n\n\n        if (data.device !== null) {\n            // select device\n            const currentDevice = data.device.id;\n            document.getElementById('devices').value = currentDevice;\n        }\n\n        if (data.context !== null) {\n            // select playlist\n            currentPlaylist = data.context.uri;\n            currentPlaylist = currentPlaylist.substring(currentPlaylist.lastIndexOf(\":\") + 1, currentPlaylist.length);\n            document.getElementById('playlists').value = currentPlaylist;\n        }\n    }\n    else if (this.status === 204) {\n\n    }\n    else if (this.status === 401) {\n        refreshAccessToken()\n    }\n    else {\n        console.log(this.responseText);\n        alert(this.responseText);\n    }\n}\n\n\n\n\n\n\n\n"]},"metadata":{},"sourceType":"module"}